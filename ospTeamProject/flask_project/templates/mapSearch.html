{% extends "index.html" %}

{% block sectionheader %}
    <title>지도로 맛집 찾기</title>
    <link rel="stylesheet" href="{{url_for('static', filename='mapSearch.css') }}">
{% endblock sectionheader %}

{% block section %}

    <!-- 탭 부분 -->
    <div id="menuType">
        <button class="typeButton" id="typeKorean" onClick="clickCategory(korean)">한식</button>
        <button class="typeButton" id="typeChinese" onClick="clickCategory(chinese)">중식</button>
        <button class="typeButton" id="typeJapanese">일식</button>
        <button class="typeButton" id="typeWestern">양식</button>
        <button class="typeButton" id="typeCafe">카페</button>
    </div>

    <!-- 지도 칸 - 웹서버 돌려야 보임 -->
    <div id="map"></div>

    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey={{map_key}}&libraries=services"></script>
    <script>
        var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
            mapOption = {
                center: new kakao.maps.LatLng(37.557596146536504, 126.94504144098624), // 지도의 중심좌표 - 이화여대 정문
                level: 3 // 지도의 확대 레벨
            };
        
        // 지도를 표시할 div와  지도 옵션으로  지도를 생성합니다
        var map = new kakao.maps.Map(mapContainer, mapOption);       

        // 카테고리 데이터 객체 배열
        let korean = {{ korean | tojson | safe }};
        let chinese = {{ chinese | tojson | safe }};
        let japanese = {{ japanese | tojson | safe }};
        let western = {{ western | tojson | safe }};
        let cafe = {{ cafe | tojson | safe }};
        document.write(korean);
        console.log(korean);
        document.write(korean.length);
        document.write(korean[0].Rname);

        
        // 주소-좌표 변환 객체를 생성합니다
        var geocoder = new kakao.maps.services.Geocoder();


        // 카테고리 클릭 시 매개변수로 음식 카테고리를 전달해줌 - map함수로 배열 요소만큼 반복 후 마커 찍어주기
        function clickCategory(foodtype) {
            
            foodtype.map(function(arraycontent, i) {
            // 주소로 좌표를 검색합니다 - 반복문 돌리기
                geocoder.addressSearch(arraycontent.address, function(result, status) {

                    // 정상적으로 검색이 완료됐으면 
                    if (status === kakao.maps.services.Status.OK) {

                        var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                        console.log(coords);

                        // 결과값으로 받은 위치를 마커로 표시합니다
                        var marker = new kakao.maps.Marker({
                            map: map,
                            position: coords,
                            clickable: true
                        });

                        // 인포윈도우로 장소에 대한 설명을 표시합니다
                        var infowindow = new kakao.maps.InfoWindow({
                            content: '<div style="width:150px;text-align:center;padding:6px 0;">'+arraycontent.Rname+'</div>',
                            removable : true
                        });
                        infowindow.open(map, marker);

                        // 결과값으로 받은 위치에 중앙에 띄움
                        map.setCenter(coords);
                    } 
                });
            })
              
        } 

       

    </script>

{% endblock section %}
